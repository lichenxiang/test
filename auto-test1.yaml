blueprint:
  name: "门磁控制小爱音箱 + V6 Mesh 点动开关（可选点动时间）"
  description: "门开关时，小爱音箱播报状态；门关时触发 V6 Mesh 点动开关，点动时间可选"
  domain: automation

  input:
    door_sensor:
      name: 门磁传感器
      description: "请选择要监听的门磁传感器"
      selector:
        entity:
          domain: binary_sensor
    speaker:
      name: 小爱音箱
      description: "请选择一个或多个小爱音箱实体"
      selector:
        target:
          entity:
            domain: notify
    mesh_switch:
      name: V6 Mesh 点动开关按钮
      description: "请选择 V6 Mesh 点动开关的 button 实体"
      selector:
        entity:
          domain: button
    mesh_inching_time:
      name: 点动时间实体
      description: "请选择 V6 Mesh 点动时间 number 实体"
      selector:
        entity:
          domain: number

trigger:
  - platform: state
    entity_id: !input door_sensor
    to:
      - "on"
      - "off"

action:
  - choose:
      # 门打开播报
      - conditions:
          - condition: state
            entity_id: !input door_sensor
            state: "on"
        sequence:
          - service: notify.send_message
            target: !input speaker
            data:
              message: "门已打开"

      # 门关闭播报 + Mesh 点动开关
      - conditions:
          - condition: state
            entity_id: !input door_sensor
            state: "off"
        sequence:
          # 播报门已关闭
          - service: notify.send_message
            target: !input speaker
            data:
              message: "门已关闭"
          # 设置点动时间
          - service: number.set_value
            target:
              entity_id: !input mesh_inching_time
            data:
              value: 3  # 这里可以固定为3秒
          # 按一次 button 执行点动
          - service: button.press
            target:
              entity_id: !input mesh_switch

mode: single
